<section class="tasks-section">
  <div class="table__title-container">
    <h3
      [ngSwitch]="!!currentCategory"
      class="tasks-section__header"
    >
      <ng-container *ngSwitchCase="false">
        У вас
      </ng-container>
      <ng-container *ngSwitchCase="true">
        В категории «{{currentCategory ? currentCategory.name : '?'}}»
      </ng-container>
      {{tasksService.tasksListSig().length === 0 ? 'нет' : tasksService.tasksListSig().length}}
      {{tasksService.tasksListSig().length | taskWordEnding}}
    </h3>
    <p-button
      class="new-task-button"
      label="Добавить задачу"
      severity="success"
      [rounded]="true"
      (click)="onAddTaskClick()"
      *ngIf="window.innerWidth > 676"
    >
    </p-button>
    <p-button
      class="new-task-button"
      icon="pi pi-plus"
      severity="success"
      [rounded]="true"
      (click)="onAddTaskClick()"
      *ngIf="window.innerWidth < 676"
    >
    </p-button>
  </div>
  <p-table
    class="table"
    [value]="tasksService.tasksListSig()"
    dataKey="name"
    [tableStyle]="{ 'min-width': '10rem' }"
    *ngIf="tasksService.tasksListSig().length > 0"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="complete" style="width: 8rem">Готово
          <p-sortIcon field="complete"></p-sortIcon>
        </th>
        <th pSortableColumn="name">Задача
          <p-sortIcon field="name"></p-sortIcon>
        </th>
        <th
          pSortableColumn="category"
          *ngIf="router.url.endsWith('all')"
          class="table__categories-header"
        >Категория
          <p-sortIcon field="category"></p-sortIcon>
        </th>
        <th
          class="table__date-cell-header"
          pSortableColumn="expiresIn"
          style="width: 8rem"
        >Срок
          <p-sortIcon field="expiresIn"></p-sortIcon>
        </th>
        <th
          class="table__priority-header"
          pSortableColumn="priority"
          style="width: 8rem"
        >Приоритет
          <p-sortIcon field="priority"></p-sortIcon>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-task>
      <tr class="table__body-row"
          (mouseenter)="task.isActionButtonsDisplay = true"
          (mouseleave)="task.isActionButtonsDisplay = false"
          (swipeleft)="task.isActionButtonsDisplay = true"
          (swiperight)="task.isActionButtonsDisplay = false"
      >
        <td>
          <p-checkbox
            [(ngModel)]="task.complete"
            [binary]="true"
            (onChange)="toggleTaskState(task)"
          ></p-checkbox>
        </td>
        <td
          class="table__task"
          [class]="{cell__name_done: task.complete}"
        >
          {{task.name}}
        </td>
        <td
          class="table__categories"
          *ngIf="router.url.endsWith('all')">{{task.category ? task.category.name : ''}}
        </td>
        <td
          class="table__date-cell date-cell">
          <i
            class="date-cell__warning-icon-container pi pi-exclamation-circle"
            [ngStyle]="{'color' : setExpirationWarningColor(task.expiresIn)}"
            *ngIf="setExpirationWarningColor(task.expiresIn) !== 'inherit'"
          ></i>
          <span class="date-cell__text"
          >{{task.expiresIn | date:
            'dd.MM.yyyy'}}</span>
        </td>
        <td class="table__priority">
          <div class="table__task-priority" *ngIf="task.priority === '1'"
               style="margin: 0 auto; width: 20px; height: 20px; background-color: blue; border-radius: 20px"></div>
          <div *ngIf="task.priority === '2'"
               style="margin: 0 auto; width: 20px; height: 20px; background-color: orange; border-radius: 20px"></div>
          <div *ngIf="task.priority === '3'"
               style="margin: 0 auto; width: 20px; height: 20px; background-color: red; border-radius: 20px"></div>
          <div class="table__task-priority" *ngIf="!task.priority"
               style="margin: 0 auto; width: 20px; height: 20px; background-color: transparent; border-radius: 20px;
             border: 1px solid
              black"></div>
        </td>
        <app-actions-menu
          [ngClass]="task.isActionButtonsDisplay ? 'action-buttons_view' : ''"
          [task]="task"
          [currentCategory]="currentCategory"
          (dataToEditEmit)="this.dataToEdit = $event"
        ></app-actions-menu>
      </tr>
    </ng-template>
  </p-table>
</section>
<ng-container *ngIf="modalService.displayTaskFormModal">
  <app-task-form [formOptions]="dataToEdit"></app-task-form>
</ng-container>




